import { PrismaClient, BookingSourceType, CertType, BenefitType } from "@prisma/client";
import { HOTEL_ID, SUB_BRAND_ID } from "../src/lib/constants";

const prisma = new PrismaClient();

interface BookingSeedData {
  id: string;
  hotelChainId: string;
  hotelChainSubBrandId: string | null;
  propertyName: string;
  checkIn: string;
  checkOut: string;
  numNights: number;
  pretaxCost: string;
  taxAmount: string;
  totalCost: string;
  creditCardId: string | null;
  shoppingPortalId: string | null;
  portalCashbackRate: string | null;
  portalCashbackOnTotal: boolean;
  loyaltyPointsEarned: number | null;
  pointsRedeemed: number | null;
  currency: string;
  originalAmount: string | null;
  bookingSource: string | null;
  otaAgencyId: string | null;
  notes: string | null;
  certificates: { certType: string }[];
  benefits: { benefitType: string; dollarValue?: number | string | null }[];
}

const CC_CHASE_ID = "cw4yg6ftdskwq651p3p8nrvnr";
const CC_WF_ID = "cvn8tp6d6nae4s543nno1qc6p";
const SP_TOPCASHBACK_ID = "cnj91ehnjvuu34xnsa8l9lem4";
const SP_BA_ID = "cjh7oskumoc40su7j747thqig";
const SP_RAKUTEN_ID = "cj774ttrj5g3wzk24foulu47x";

async function main() {
  const bookings: BookingSeedData[] = [
    {
      id: "clas2mljema779deuxi5mhuee",
      hotelChainId: HOTEL_ID.MARRIOTT,
      hotelChainSubBrandId: SUB_BRAND_ID.MARRIOTT.AUTOGRAPH_COLLECTION,
      propertyName: "Duxton Reserve Singapore",
      checkIn: "2026-03-02T00:00:00.000Z",
      checkOut: "2026-03-05T00:00:00.000Z",
      numNights: 3,
      pretaxCost: "0",
      taxAmount: "0",
      totalCost: "0",
      creditCardId: null,
      shoppingPortalId: null,
      portalCashbackRate: null,
      portalCashbackOnTotal: false,
      loyaltyPointsEarned: null,
      pointsRedeemed: null,
      currency: "USD",
      originalAmount: null,
      bookingSource: "direct_web",
      otaAgencyId: null,
      notes: null,
      certificates: [
        { certType: "marriott_50k" },
        { certType: "marriott_50k" },
        { certType: "marriott_50k" },
      ],
      benefits: [],
    },
    {
      id: "c83ak8zknu6pwcvqhbfhm7ekv",
      hotelChainId: HOTEL_ID.HYATT,
      hotelChainSubBrandId: SUB_BRAND_ID.HYATT.PARK_HYATT,
      propertyName: "Park Hyatt Kuala Lumpur",
      checkIn: "2026-03-06T00:00:00.000Z",
      checkOut: "2026-03-07T00:00:00.000Z",
      numNights: 1,
      pretaxCost: "0",
      taxAmount: "0",
      totalCost: "0",
      creditCardId: null,
      shoppingPortalId: null,
      portalCashbackRate: null,
      portalCashbackOnTotal: false,
      loyaltyPointsEarned: null,
      pointsRedeemed: null,
      currency: "USD",
      originalAmount: null,
      bookingSource: "direct_web",
      otaAgencyId: null,
      notes: null,
      certificates: [{ certType: "hyatt_cat1_7" }],
      benefits: [],
    },
    {
      id: "ct05t6xeejpm9q6dxgtvei3r8",
      hotelChainId: HOTEL_ID.IHG,
      hotelChainSubBrandId: SUB_BRAND_ID.IHG.HOLIDAY_INN_EXPRESS,
      propertyName: "Holiday Inn Express KL City Centre",
      checkIn: "2026-03-06T00:00:00.000Z",
      checkOut: "2026-03-07T00:00:00.000Z",
      numNights: 1,
      pretaxCost: "58",
      taxAmount: "11",
      totalCost: "69",
      creditCardId: CC_CHASE_ID,
      shoppingPortalId: SP_TOPCASHBACK_ID,
      portalCashbackRate: "0.24",
      portalCashbackOnTotal: false,
      loyaltyPointsEarned: 1160,
      pointsRedeemed: null,
      currency: "USD",
      originalAmount: null,
      bookingSource: null,
      otaAgencyId: null,
      notes: null,
      certificates: [],
      benefits: [],
    },
    {
      id: "c4mv6rvmc0pln9mk7txqlshkm",
      hotelChainId: HOTEL_ID.IHG,
      hotelChainSubBrandId: SUB_BRAND_ID.IHG.HOTEL_INDIGO,
      propertyName: "Hotel Indigo Kuala Lumpur",
      checkIn: "2026-03-07T00:00:00.000Z",
      checkOut: "2026-03-13T00:00:00.000Z",
      numNights: 6,
      pretaxCost: "528",
      taxAmount: "43",
      totalCost: "571",
      creditCardId: CC_WF_ID,
      shoppingPortalId: SP_TOPCASHBACK_ID,
      portalCashbackRate: "0.12",
      portalCashbackOnTotal: false,
      loyaltyPointsEarned: 10560,
      pointsRedeemed: null,
      currency: "USD",
      originalAmount: null,
      bookingSource: "direct_web",
      otaAgencyId: null,
      notes: null,
      certificates: [],
      benefits: [],
    },
    {
      id: "cufi5o67mbga7e8an9rvsb2vn",
      hotelChainId: HOTEL_ID.HYATT,
      hotelChainSubBrandId: SUB_BRAND_ID.HYATT.HYATT_CENTRIC,
      propertyName: "Hyatt Centric Kuala Lumpur",
      checkIn: "2026-03-13T00:00:00.000Z",
      checkOut: "2026-03-20T00:00:00.000Z",
      numNights: 7,
      pretaxCost: "0",
      taxAmount: "0",
      totalCost: "0",
      creditCardId: null,
      shoppingPortalId: null,
      portalCashbackRate: null,
      portalCashbackOnTotal: false,
      loyaltyPointsEarned: null,
      pointsRedeemed: 24500,
      currency: "USD",
      originalAmount: null,
      bookingSource: "direct_web",
      otaAgencyId: null,
      notes: null,
      certificates: [],
      benefits: [],
    },
    {
      id: "ctshv1is5aacu6rwsrsebfyxi",
      hotelChainId: HOTEL_ID.GHA_DISCOVERY,
      hotelChainSubBrandId: SUB_BRAND_ID.GHA_DISCOVERY.SUNWAY,
      propertyName: "Sunway Velocity Hotel",
      checkIn: "2026-03-20T00:00:00.000Z",
      checkOut: "2026-03-22T00:00:00.000Z",
      numNights: 2,
      pretaxCost: "150",
      taxAmount: "13",
      totalCost: "163",
      creditCardId: CC_CHASE_ID,
      shoppingPortalId: null,
      portalCashbackRate: null,
      portalCashbackOnTotal: false,
      loyaltyPointsEarned: 1050,
      pointsRedeemed: null,
      currency: "USD",
      originalAmount: null,
      bookingSource: "direct_app",
      otaAgencyId: null,
      notes: null,
      certificates: [],
      benefits: [],
    },
    {
      id: "cnrxt78gdols3zb0bxsmaciaq",
      hotelChainId: HOTEL_ID.GHA_DISCOVERY,
      hotelChainSubBrandId: SUB_BRAND_ID.GHA_DISCOVERY.PARKROYAL,
      propertyName: "Park Royal Serviced Suites KL",
      checkIn: "2026-03-22T00:00:00.000Z",
      checkOut: "2026-03-24T00:00:00.000Z",
      numNights: 2,
      pretaxCost: "166",
      taxAmount: "14",
      totalCost: "180",
      creditCardId: CC_CHASE_ID,
      shoppingPortalId: null,
      portalCashbackRate: null,
      portalCashbackOnTotal: false,
      loyaltyPointsEarned: 1162,
      pointsRedeemed: null,
      currency: "USD",
      originalAmount: null,
      bookingSource: "direct_app",
      otaAgencyId: null,
      notes: null,
      certificates: [],
      benefits: [],
    },
    {
      id: "cwy9rm93feastnxmna5u75arp",
      hotelChainId: HOTEL_ID.GHA_DISCOVERY,
      hotelChainSubBrandId: SUB_BRAND_ID.GHA_DISCOVERY.PARKROYAL_COLLECTION,
      propertyName: "Park Royal Collection KL",
      checkIn: "2026-03-24T00:00:00.000Z",
      checkOut: "2026-03-26T00:00:00.000Z",
      numNights: 2,
      pretaxCost: "299",
      taxAmount: "24",
      totalCost: "323",
      creditCardId: CC_CHASE_ID,
      shoppingPortalId: null,
      portalCashbackRate: null,
      portalCashbackOnTotal: false,
      loyaltyPointsEarned: 2093,
      pointsRedeemed: null,
      currency: "USD",
      originalAmount: null,
      bookingSource: "direct_app",
      otaAgencyId: null,
      notes: null,
      certificates: [],
      benefits: [],
    },
    {
      id: "cuj2d4xsen4rntp0ujp9gvjb0",
      hotelChainId: HOTEL_ID.MARRIOTT,
      hotelChainSubBrandId: SUB_BRAND_ID.MARRIOTT.CITIZENM,
      propertyName: "citizenM Kuala Lumpur",
      checkIn: "2026-03-26T00:00:00.000Z",
      checkOut: "2026-03-27T00:00:00.000Z",
      numNights: 1,
      pretaxCost: "60",
      taxAmount: "4",
      totalCost: "64",
      creditCardId: CC_CHASE_ID,
      shoppingPortalId: SP_BA_ID,
      portalCashbackRate: "6",
      portalCashbackOnTotal: false,
      loyaltyPointsEarned: 1050,
      pointsRedeemed: null,
      currency: "USD",
      originalAmount: null,
      bookingSource: "direct_web",
      otaAgencyId: null,
      notes: null,
      certificates: [],
      benefits: [],
    },
    {
      id: "cscx18qakqticrsl6g6xvh7ha",
      hotelChainId: HOTEL_ID.HYATT,
      hotelChainSubBrandId: SUB_BRAND_ID.HYATT.HYATT_CENTRIC,
      propertyName: "Hyatt Centric Kuala Lumpur",
      checkIn: "2026-03-27T00:00:00.000Z",
      checkOut: "2026-04-03T00:00:00.000Z",
      numNights: 7,
      pretaxCost: "0",
      taxAmount: "0",
      totalCost: "0",
      creditCardId: null,
      shoppingPortalId: null,
      portalCashbackRate: null,
      portalCashbackOnTotal: false,
      loyaltyPointsEarned: null,
      pointsRedeemed: 35000,
      currency: "USD",
      originalAmount: null,
      bookingSource: "direct_web",
      otaAgencyId: null,
      notes: null,
      certificates: [],
      benefits: [],
    },
    {
      id: "cy58uq56kllc6feidriho04yh",
      hotelChainId: HOTEL_ID.HYATT,
      hotelChainSubBrandId: SUB_BRAND_ID.HYATT.HYATT_PLACE,
      propertyName: "Hyatt Place Bukit Jalil",
      checkIn: "2026-04-03T00:00:00.000Z",
      checkOut: "2026-04-10T00:00:00.000Z",
      numNights: 7,
      pretaxCost: "0",
      taxAmount: "0",
      totalCost: "0",
      creditCardId: null,
      shoppingPortalId: null,
      portalCashbackRate: null,
      portalCashbackOnTotal: false,
      loyaltyPointsEarned: null,
      pointsRedeemed: 35000,
      currency: "USD",
      originalAmount: null,
      bookingSource: "direct_web",
      otaAgencyId: null,
      notes: null,
      certificates: [],
      benefits: [],
    },
    {
      id: "cc2gaeqcxn2mj300o28duzvd5",
      hotelChainId: HOTEL_ID.MARRIOTT,
      hotelChainSubBrandId: SUB_BRAND_ID.MARRIOTT.MOXY,
      propertyName: "Moxy KL Chinatown",
      checkIn: "2026-04-10T00:00:00.000Z",
      checkOut: "2026-04-14T00:00:00.000Z",
      numNights: 4,
      pretaxCost: "257",
      taxAmount: "46",
      totalCost: "303",
      creditCardId: CC_CHASE_ID,
      shoppingPortalId: SP_BA_ID,
      portalCashbackRate: "6",
      portalCashbackOnTotal: false,
      loyaltyPointsEarned: 4498,
      pointsRedeemed: null,
      currency: "USD",
      originalAmount: null,
      bookingSource: "direct_web",
      otaAgencyId: null,
      notes: null,
      certificates: [],
      benefits: [{ benefitType: "free_breakfast" }],
    },
    {
      id: "cpmpa0buq8jl85t5wcv13wvi8",
      hotelChainId: HOTEL_ID.MARRIOTT,
      hotelChainSubBrandId: SUB_BRAND_ID.MARRIOTT.TRIBUTE_PORTFOLIO,
      propertyName: "The Serangoon House Little India",
      checkIn: "2026-04-14T00:00:00.000Z",
      checkOut: "2026-04-15T00:00:00.000Z",
      numNights: 1,
      pretaxCost: "186",
      taxAmount: "37",
      totalCost: "223",
      creditCardId: CC_CHASE_ID,
      shoppingPortalId: null,
      portalCashbackRate: null,
      portalCashbackOnTotal: false,
      loyaltyPointsEarned: 3255,
      pointsRedeemed: null,
      currency: "USD",
      originalAmount: null,
      bookingSource: "direct_web",
      otaAgencyId: null,
      notes: null,
      certificates: [],
      benefits: [
        { benefitType: "free_breakfast" },
        { benefitType: "dining_credit", dollarValue: 75 },
      ],
    },
    {
      id: "cmgz12kjvzu90qvn5wxrki7ui",
      hotelChainId: HOTEL_ID.ACCOR,
      hotelChainSubBrandId: SUB_BRAND_ID.ACCOR.IBIS_STYLES,
      propertyName: "ibis Styles Ambassador ICN",
      checkIn: "2026-04-15T00:00:00.000Z",
      checkOut: "2026-04-16T00:00:00.000Z",
      numNights: 1,
      pretaxCost: "82",
      taxAmount: "9",
      totalCost: "91",
      creditCardId: CC_CHASE_ID,
      shoppingPortalId: SP_RAKUTEN_ID,
      portalCashbackRate: "2",
      portalCashbackOnTotal: false,
      loyaltyPointsEarned: 150,
      pointsRedeemed: null,
      currency: "USD",
      originalAmount: null,
      bookingSource: "direct_web",
      otaAgencyId: null,
      notes: null,
      certificates: [],
      benefits: [],
    },
  ];

  for (const b of bookings) {
    const { certificates, benefits, ...bookingData } = b;

    const payload = {
      ...bookingData,
      bookingSource: bookingData.bookingSource as BookingSourceType,
      certificates: {
        create: certificates.map((c) => ({ certType: c.certType as CertType })),
      },
      benefits: {
        create: benefits.map((b) => ({
          benefitType: b.benefitType as BenefitType,
          dollarValue: b.dollarValue ? Number(b.dollarValue) : null,
        })),
      },
    };

    await prisma.booking.upsert({
      where: { id: b.id },
      update: {
        ...payload,
        certificates: {
          deleteMany: {},
          ...payload.certificates,
        },
        benefits: {
          deleteMany: {},
          ...payload.benefits,
        },
      },
      create: payload,
    });
  }

  console.log("Bookings restored/upserted successfully");
}

main()
  .catch((e) => {
    console.error(e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
